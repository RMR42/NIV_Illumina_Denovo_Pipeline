// nextflow.config

params {
    // Help flag
    help = false
    
    // Core parameters - can be overridden by JSON params file
    input_dir = null
    outdir = "${launchDir}/results"
    do_norm = true
    
    // Derived directory paths
    reports_dir = "${params.outdir}/reports"
    trimmed_reads = "${params.outdir}/trimmed_reads"
    normalised_reads = "${params.outdir}/normalised_reads"
    assembly_dir = "${params.outdir}/assembly_results"
    post_assembly_dir = "${params.outdir}/post_assembly_results"
    raw_fastqc_reports = "${params.reports_dir}/raw_fastqc"
    trimmed_fastqc_reports = "${params.reports_dir}/trimmed_fastqc"
}

// Profiles for different execution environments
// conda : recommended for external users (requires conda/mamba)
// hpc   : for SLURM cluster execution using environment modules
//         (configured for ICMR-NIV NAKSHATRA HPC â€” module names may differ on other systems)

profiles {

    conda {
        conda.enabled = true

        process {
            conda    = "${projectDir}/envs/viral_assembly.yml"
            executor = 'local'

            withName: NORMALISATION {
                memory = '24 GB'
                cpus   = 1
            }
        }
    }

    hpc {
        process {
            executor = 'slurm'
            queue = 'cpu-long'
            cpus = 16


            withName: RAW_FASTQC {
                module = 'fastqc-0.12.1'
            }
            withName: FASTP {
                module = 'fastp-1.0.1'
            }
            withName: FINAL_FASTQC {
                module = 'fastqc-0.12.1'
            }
            withName: SPADES_ASSEMBLY {
                module = 'spades-4.2.0'
            }
            withName: NORMALISATION {
                module = 'bbtools-39.38'
                memory = '24 GB'
                cpus   = 8
            }
            withName: QUAST {
                module = 'quast-5.3.0'
            }

        }
    }
}

// Report configuration
// Paths are provided via command line flags in run_pipeline.sh
report {
    enabled = true
    overwrite = true
}

timeline {
    enabled = true
    overwrite = true
}

trace {
    enabled = true
    overwrite = true
}

// Execution settings
executor {
    queueSize = 100
}

// Process settings
process {
    errorStrategy = 'retry'
    maxRetries = 2
}
